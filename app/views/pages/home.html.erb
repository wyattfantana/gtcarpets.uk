<!-- About Us Section -->
<section id="about" class="landscape-bg">
    <div class="container">
      <h2>About Us</h2>
      <div class="about-content">
        <%= simple_format(Setting.get_or_default('about_us', 'At GT Carpets, we pride ourselves on delivering quality carpet services.')) %>
      </div>
    </div>
  </section>
  
  <!-- Services Section -->
  <section id="services" class="landscape-bg">
    <div class="container">
      <h2>Our Expertise</h2>
      <div class="services-list">
        <% expertise_content = Setting.get_or_default('our_expertise', 'Personalized Consultation
We provide personalized consultations to understand your specific needs, help you navigate our extensive range of options, and ensure the final installation exceeds your expectations.

Carpet Installation
Discover the warmth and comfort that a new carpet can bring to your home. We offer a comprehensive selection of styles and materials to suit any room, ensuring a perfect match for your décor and lifestyle needs.

Vinyl Flooring Installation
For durability and style, our vinyl flooring options are unmatched. Ideal for kitchens, bathrooms, and high-traffic areas, vinyl offers a versatile solution that combines easy maintenance with aesthetic appeal.') %>
        
        <% expertise_content.split(/\n\s*\n/).each do |service_block| %>
          <% lines = service_block.strip.split(/\n/) %>
          <% if lines.length >= 2 %>
            <div class="service">
              <h3><%= lines.first %></h3>
              <div class="service-content">
                <p><%= lines[1..-1].join(' ') %></p>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>
  </section>
  
  <!-- Gallery Section -->
  <% if Setting.enabled?('gallery_enabled') && Gallery.featured_galleries.any? %>
  <section id="gallery" class="landscape-bg">
    <div class="container">
      <h2>Our Work Gallery</h2>
      <p>See examples of our professional carpet and vinyl installation work</p>
      
      <div class="gallery-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-top: 2rem;">
        <% Gallery.featured_galleries.each_with_index do |gallery_item, index| %>
          <div class="gallery-card" style="background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: transform 0.3s ease, box-shadow 0.3s ease; cursor: pointer;" 
               onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 12px rgba(0,0,0,0.15)'"
               onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 6px rgba(0,0,0,0.1)'"
               onclick="openHomepageLightbox(<%= index %>)">
            <img src="<%= gallery_item.display_image_url %>" 
                 alt="Gallery Image" 
                 style="width: 100%; height: 200px; object-fit: cover;" 
                 onerror="this.src='https://via.placeholder.com/400x200/f8f9fa/999999?text=Image+Not+Found'">
          </div>
        <% end %>
      </div>
      
      <div style="text-align: center; margin-top: 2rem;">
        <%= link_to "View All Gallery Photos", gallery_path, class: "btn", style: "font-size: 1.1rem; padding: 12px 24px;" %>
      </div>
    </div>
  </section>
  
  <!-- Homepage Lightbox Modal -->
  <div id="homepage-lightbox" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 9999; cursor: pointer;" onclick="closeHomepageLightbox()">
    <div style="position: absolute; top: 20px; right: 30px; color: white; font-size: 40px; cursor: pointer; z-index: 10000;" onclick="closeHomepageLightbox()">&times;</div>
    
    <div style="position: absolute; left: 30px; top: 50%; transform: translateY(-50%); color: white; font-size: 50px; cursor: pointer; user-select: none; z-index: 10000;" onclick="event.stopPropagation(); changeHomepageImage(-1)">&#10094;</div>
    
    <div style="position: absolute; right: 30px; top: 50%; transform: translateY(-50%); color: white; font-size: 50px; cursor: pointer; user-select: none; z-index: 10000;" onclick="event.stopPropagation(); changeHomepageImage(1)">&#10095;</div>
    
    <div style="display: flex; justify-content: center; align-items: center; height: 100%;">
      <img id="homepage-lightbox-img" src="" alt="Gallery Image" style="max-width: 90%; max-height: 90%; object-fit: contain;" onclick="event.stopPropagation()">
    </div>
    
    <div id="homepage-image-counter" style="position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); color: white; font-size: 18px; text-align: center;"></div>
  </div>

  <script>
    const homepageGalleryImages = [
      <% Gallery.featured_galleries.each_with_index do |gallery_item, index| %>
        '<%= gallery_item.display_image_url %>'<%= index < Gallery.featured_galleries.count - 1 ? ',' : '' %>
      <% end %>
    ];
    
    let currentHomepageImageIndex = 0;
    
    function openHomepageLightbox(index) {
      currentHomepageImageIndex = index;
      const lightbox = document.getElementById('homepage-lightbox');
      const lightboxImg = document.getElementById('homepage-lightbox-img');
      const counter = document.getElementById('homepage-image-counter');
      
      lightboxImg.src = homepageGalleryImages[currentHomepageImageIndex];
      counter.textContent = `${currentHomepageImageIndex + 1} / ${homepageGalleryImages.length}`;
      lightbox.style.display = 'block';
      document.body.style.overflow = 'hidden'; // Prevent scrolling
    }
    
    function closeHomepageLightbox() {
      document.getElementById('homepage-lightbox').style.display = 'none';
      document.body.style.overflow = 'auto'; // Restore scrolling
    }
    
    function changeHomepageImage(direction) {
      currentHomepageImageIndex += direction;
      
      // Handle wraparound
      if (currentHomepageImageIndex >= homepageGalleryImages.length) {
        currentHomepageImageIndex = 0;
      } else if (currentHomepageImageIndex < 0) {
        currentHomepageImageIndex = homepageGalleryImages.length - 1;
      }
      
      const lightboxImg = document.getElementById('homepage-lightbox-img');
      const counter = document.getElementById('homepage-image-counter');
      
      lightboxImg.src = homepageGalleryImages[currentHomepageImageIndex];
      counter.textContent = `${currentHomepageImageIndex + 1} / ${homepageGalleryImages.length}`;
    }
    
    // Keyboard navigation for homepage lightbox
    document.addEventListener('keydown', function(e) {
      const lightbox = document.getElementById('homepage-lightbox');
      if (lightbox.style.display === 'block') {
        if (e.key === 'Escape') {
          closeHomepageLightbox();
        } else if (e.key === 'ArrowLeft') {
          changeHomepageImage(-1);
        } else if (e.key === 'ArrowRight') {
          changeHomepageImage(1);
        }
      }
    });
  </script>
  <% end %>
  
  <!-- Pricing Calculator Section -->
  <% if Setting.enabled?('calculator_enabled') %>
  <section id="calculator" class="landscape-bg">
    <div class="container">
      <h2>Flooring Price Calculator</h2>
      <p>Estimate the cost of your flooring installation using the form below:</p>
  
      <%= form_with url: '/carpet_price_calculator', method: :post, local: true, id: 'calculator-form' do %>
        <!-- Dropdown for Fitting Type (Carpet/Vinyl) -->
        <div>
          <%= label_tag :fitting_type, "Fitting Type:" %>
          <%= select_tag :fitting_type, options_for_select([['Carpet', 'carpet'], ['Vinyl', 'vinyl']], params[:fitting_type]), { prompt: 'Select Carpet or Vinyl', class: "form-control", required: true, onchange: "updateFittingOptions()" } %>
        </div>
  
        <div class="form-row">
          <div class="form-col">
            <%= label_tag :length, "Room Length (in meters):" %>
            <%= number_field_tag :length, params[:length], placeholder: "Enter length", class: "form-control", required: true, step: "0.01", min: "0.01" %>
            <small class="form-text text-muted">You can use up to 2 decimal places (e.g. 3.25)</small>
          </div>
  
          <div class="form-col">
            <%= label_tag :width, "Room Width (in meters):" %>
            <%= number_field_tag :width, params[:width], placeholder: "Enter width (max 4m)", class: "form-control", required: true, step: "0.01", min: "0.01", max: "4.00", oninput: "validateWidth(this)" %>
            <small class="form-text text-muted">Maximum width is 4 meters (standard roll width).</small>
          </div>
        </div>
  
        <!-- Conditional Options for Carpet or Vinyl -->
        <div id="gripper_rods_option" style="display: none;">
          <%= label_tag :gripper_rods, "Do you need Gripper Rods?" %>
          <%= select_tag :gripper_rods, options_for_select([['Yes', 'yes'], ['No', 'no']], params[:gripper_rods]), { prompt: 'Select Yes or No', class: "form-control" } %>
        </div>
  
        <div id="underlay_option" style="display: none;">
          <%= label_tag :underlay, "Do you need Underlay?" %>
          <%= select_tag :underlay, options_for_select([['Yes', 'yes'], ['No', 'no']], params[:underlay]), { prompt: 'Select Yes or No', class: "form-control" } %>
        </div>
  
        <div id="plyboarding_option" style="display: none;">
          <%= label_tag :plyboarding, "Do you need Plyboarding?" %>
          <%= select_tag :plyboarding, options_for_select([['Yes', 'yes'], ['No', 'no']], params[:plyboarding]), { prompt: 'Select Yes or No', class: "form-control" } %>
        </div>
  
        <!-- Number Field for Door Trims -->
        <div>
          <%= label_tag :door_trims, "Number of Door Trims:" %>
          <%= number_field_tag :door_trims, params[:door_trims] || 0, min: 0, step: 1, class: "form-control", required: true %>
        </div>
  
        <div class="text-center">
          <%= submit_tag "Calculate", class: "btn" %>
        </div>
      <% end %>
  
      <% if @total_cost %>
        <div id="quote-box" style="border: 1px solid #ddd; padding: 20px; border-radius: 8px; background-color: #f9f9f9; margin-top: 20px;">
          <div style="text-align: center; margin-bottom: 20px;">
            <h3 style="color: #2A9D8F;">Estimated Quote</h3>
            <p style="font-style: italic; color: #666;">Please note: This is an estimated price. The final cost may vary based on specific requirements and site conditions.</p>
          </div>

          <!-- Two columns layout -->
          <div style="display: flex; justify-content: space-between;">
            <!-- Left Column: Services -->
            <div style="width: 48%; text-align: left; font-size: 1.1em;">
              <p style="font-weight: bold;"><%= @area.round(2) %> sqm of <%= params[:fitting_type] %> fitted</p>

              <% if params[:underlay] == 'yes' && params[:fitting_type] == 'carpet' %>
                <p style="font-weight: bold;"><%= @area.round(2) %> sqm of underlay supplied and fitted</p>
              <% end %>

              <% if params[:plyboarding] == 'yes' && params[:fitting_type] == 'vinyl' %>
                <p style="font-weight: bold;"><%= @area.round(2) %> sqm of plyboard supplied and fitted</p>
              <% end %>

              <p>Spray adhesive supplied</p>

              <% if params[:door_trims].to_i > 0 %>
                <p><%= params[:door_trims] %> door trim(s) supplied and fitted</p>
              <% end %>
            </div>

            <!-- Right Column: Costs -->
            <div style="width: 48%; text-align: right; font-size: 1.1em;">
              <p style="font-weight: bold;">Estimated total:</p>
              <p style="font-size: 2em; font-weight: bold; color: #2A9D8F;">£<%= sprintf('%.2f', @formatted_cost) %></p>
            </div>
          </div>

          <hr style="margin: 20px 0;">

          <div style="text-align: center;">
            <p>For an accurate quote and to book your fitting with GT Carpets, please use the contact form below. We'll arrange a site visit to confirm measurements and provide a final quote.</p>
            <p>We look forward to working with you!</p>
            <p style="font-weight: bold;">Gareth<br>GT Carpets</p>
          </div>
        </div>
      <% end %>
    </div>
  </section>
  
  <script>
    function validateWidth(input) {
      if (input.value > 4) {
        input.value = 4;
        alert('Maximum width is 4 meters (standard roll width)');
      }
    }

    function updateFittingOptions() {
      var fittingType = document.getElementById('fitting_type').value;
      var gripperRodOption = document.getElementById('gripper_rods_option');
      var underlayOption = document.getElementById('underlay_option');
      var plyboardingOption = document.getElementById('plyboarding_option');
  
      // Hide all options first
      gripperRodOption.style.display = 'none';
      underlayOption.style.display = 'none';
      plyboardingOption.style.display = 'none';
  
      // Show relevant options based on selection
      if (fittingType === 'carpet') {
        gripperRodOption.style.display = 'block';
        underlayOption.style.display = 'block';
      } else if (fittingType === 'vinyl') {
        plyboardingOption.style.display = 'block';
      }
    }
  
    // Run on page load to set initial state
    document.addEventListener('DOMContentLoaded', function() {
      updateFittingOptions();
      
      // Add change event listener
      document.getElementById('fitting_type').addEventListener('change', updateFittingOptions);
    });
  </script>
  </section>
  <% end %>
  
<!-- Contact Section -->
<section id="contact" class="landscape-bg">
  <div class="container">
    <h2>Contact Us</h2>
    <p>Ready to get started? Contact us today for a free, no-obligation consultation!</p>
    
    <%= form_with model: @contact, url: contacts_path, id: "contact-form" do |form| %>
      <div>
        <%= form.label :name, "Name:" %>
        <%= form.text_field :name, required: true, placeholder: "Your Name", class: "form-control" %>
      </div>
      <div>
        <%= form.label :email, "Email:" %>
        <%= form.email_field :email, required: true, placeholder: "Your Email", class: "form-control" %>
      </div>
      <div>
        <%= form.label :message, "Message:" %>
        <%= form.text_area :message, rows: 4, required: true, placeholder: "How can we help you?", class: "form-control" %>
      </div>
      
      <!-- reCAPTCHA widget -->
      <div class="g-recaptcha" data-sitekey="<%= ENV['RECAPTCHA_SITE_KEY'] %>"></div>
      
      <div class="text-center">
        <%= form.submit "Send Message", class: "btn" %>
      </div>
    <% end %>
  </div>
</section>

  